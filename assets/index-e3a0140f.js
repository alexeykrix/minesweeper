var d=Object.defineProperty;var g=(n,t,e)=>t in n?d(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var h=(n,t,e)=>(g(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();const a="EMPTY",o="BOMB",m="FLAG";class f{constructor(t=.5){h(this,"state","");h(this,"showed",!1);h(this,"isFlag",!1);h(this,"bobmPercentage");this.bobmPercentage=t+1,this.state=this.getRandomState()}makeVisible(){this.showed=!0}toggleFlag(){this.isFlag=!this.isFlag}getRandomState(){switch(Math.ceil(Math.random()*this.bobmPercentage)){case 1:return a;default:return o}}}class C{constructor(t=".game",e=15){h(this,"htmlElem");h(this,"gridSize");h(this,"gameArray");h(this,"bobmPercentage",.2);h(this,"firstClick",!0);h(this,"isGameOver",!1);h(this,"touchTimeout",null);h(this,"lastChange",{x:null,y:null});h(this,"touch",{lastX:null,lastY:null});this.htmlElem=document.querySelector(t),this.gridSize=e,this.htmlElem.style.setProperty("--cels",e)}init(){this.createArray(),this.renderArray(),this.setEvents()}restart(){this.htmlElem.style.setProperty("--cels",this.gridSize),this.firstClick=!0,this.isGameOver=!1,this.createArray(),this.renderArray()}getCell(t,e){return t<0||t>this.gridSize-1||e<0||e>this.gridSize-1?{state:null}:this.gameArray[t][e]}countBombsAround(t,e){let i=0;return this.getCell(t-1,e-1).state===o&&i++,this.getCell(t,e-1).state===o&&i++,this.getCell(t+1,e-1).state===o&&i++,this.getCell(t+1,e).state===o&&i++,this.getCell(t+1,e+1).state===o&&i++,this.getCell(t,e+1).state===o&&i++,this.getCell(t-1,e+1).state===o&&i++,this.getCell(t-1,e).state===o&&i++,i}renderArray(){let t="";this.gameArray.forEach((e,i)=>{e.forEach((r,s)=>{let l=a;r.state===a?r.showed===!0?l="num cell-num-"+this.countBombsAround(i,s):l=a:r.state===o&&this.isGameOver&&(l=o),r.isFlag&&r.showed===!1&&(l=m,r.state===o&&this.isGameOver&&(l=o));const c=this.lastChange.x===i&&this.lastChange.y===s?"animate":"";t+=`
        <div class="cell 
          ${r.showed?"cell-SHOWED":""} 
          cell-${l} 
          ${c}" 
          data-x="${i}" data-y="${s}"
        ></div>`})}),this.htmlElem.innerHTML=t}createArray(){const t=[];for(let e=0;e<this.gridSize;e++){const i=[];for(let r=0;r<this.gridSize;r++)i.push(new f(this.bobmPercentage));t.push(i)}this.gameArray=t}handleEmptyClick(t,e,i){if(t.showed=!0,this.countBombsAround(e,i)===0){const r=(s,l)=>{s<0||s>this.gridSize-1||l<0||l>this.gridSize-1||(this.countBombsAround(s+1,l)===0&&(this.getCell(s+1,l).showed||(this.getCell(s+1,l).showed=!0,r(s+1,l))),this.countBombsAround(s-1,l)===0&&(this.getCell(s-1,l).showed||(this.getCell(s-1,l).showed=!0,r(s-1,l))),this.countBombsAround(s,l+1)===0&&(this.getCell(s,l+1).showed||(this.getCell(s,l+1).showed=!0,r(s,l+1))),this.countBombsAround(s,l-1)===0&&(this.getCell(s,l-1).showed||(this.getCell(s,l-1).showed=!0,r(s,l-1))),this.getCell(s+1,l).showed=!0,this.getCell(s-1,l).showed=!0,this.getCell(s,l+1).showed=!0,this.getCell(s,l-1).showed=!0,this.getCell(s+1,l).isFlag=!1,this.getCell(s-1,l).isFlag=!1,this.getCell(s,l+1).isFlag=!1,this.getCell(s,l-1).isFlag=!1)};r(e,i)}}handleCellClick(t,e){const i=this.getCell(t,e);this.firstClick&&(this.firstClick=!1,i.state=a,this.getCell(t-1,e-1).state=a,this.getCell(t+1,e-1).state=a,this.getCell(t+1,e+1).state=a,this.getCell(t-1,e+1).state=a,this.getCell(t,e-1).state=a,this.getCell(t+1,e).state=a,this.getCell(t,e+1).state=a,this.getCell(t-1,e).state=a),i.state===a&&this.handleEmptyClick(i,t,e),i.state===o&&(this.isGameOver=!0),this.renderArray()}toggleFlag(t,e){const i=this.getCell(t,e);i.isShowed||(i.isFlag=!i.isFlag,this.renderArray())}clickHandler(t,e=!1){const i=t.target,r=i.closest(".cell"),s=i.closest(".btn-restart"),l=i.closest(".btn-size");if(r){if(!e&&("ontouchstart"in window||navigator.maxTouchPoints))return;const{x:c,y:u}=r.dataset;this.lastChange.x=+c,this.lastChange.y=+u,this.handleCellClick(+c,+u)}s&&this.restart(),l&&(this.gridSize=+l.dataset.size,this.restart())}rightClickHandler(t){t.preventDefault();const i=t.target.closest(".cell");if(i){const{x:r,y:s}=i.dataset;this.lastChange.x=+r,this.lastChange.y=+s,this.toggleFlag(+r,+s)}}handleTouch(t){this.touch.lastX=t.touches[0].clientX,this.touch.lastY=t.touches[0].clientY,!(t.touches.length>1)&&(this.touchTimeout=setTimeout(()=>{clearTimeout(this.touchTimeout),this.touchTimeout=null,this.rightClickHandler(t)},200))}handleTouchend(t){if(this.touchTimeout){clearTimeout(this.touchTimeout),this.touchTimeout=null,this.clickHandler(t,!0);return}this.touchTimeout=null}handleTouchmove(t){const e=Math.abs(this.touch.lastX-t.touches[0].clientX),i=Math.abs(this.touch.lastY-t.touches[0].clientY);(e+i>3||t.touches.length>1)&&(clearTimeout(this.touchTimeout),this.touchTimeout=null)}setEvents(){document.addEventListener("click",this.clickHandler.bind(this)),"ontouchstart"in window||navigator.maxTouchPoints?(document.addEventListener("touchstart",this.handleTouch.bind(this)),document.addEventListener("touchend",this.handleTouchend.bind(this)),document.addEventListener("touchmove",this.handleTouchmove.bind(this))):this.htmlElem.addEventListener("contextmenu",this.rightClickHandler.bind(this))}}new C().init();
