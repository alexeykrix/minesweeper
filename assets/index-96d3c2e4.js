var C=Object.defineProperty;var b=(n,t,s)=>t in n?C(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var r=(n,t,s)=>(b(n,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const e of a)if(e.type==="childList")for(const l of e.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const e={};return a.integrity&&(e.integrity=a.integrity),a.referrerPolicy&&(e.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?e.credentials="include":a.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(a){if(a.ep)return;a.ep=!0;const e=s(a);fetch(a.href,e)}})();const o="EMPTY",h="BOMB",w="FLAG";class m{constructor({text:t="",className:s="",isHidden:i=!1}){r(this,"text");r(this,"className");r(this,"isHidden");r(this,"html");this.text=t,this.className=s,this.isHidden=i,this.addToDocument()}layout(){const t=document.createElement("div");return t.innerHTML=this.text,t.classList=`main-btn ${this.className}`,this.isHidden&&(t.style.display="none",t.style.opacity="0"),t}addToDocument(){this.html=this.layout(),document.body.append(this.html)}hide(){this.html.style.opacity=0,setTimeout(()=>{this.html.style.display="none"},400),this.isHidden=!0}show(){this.html.style.display="flex",setTimeout(()=>{this.html.style.opacity=1},0),this.isHidden=!1}}class v{constructor(t=.5){r(this,"state","");r(this,"showed",!1);r(this,"isFlag",!1);r(this,"bobmPercentage");this.bobmPercentage=t+1,this.state=this.getRandomState()}makeVisible(){this.showed=!0}toggleFlag(){this.isFlag=!this.isFlag}getRandomState(){switch(Math.ceil(Math.random()*this.bobmPercentage)){case 1:return o;default:return h}}}class p{constructor(t){r(this,"touch",{lastX:null,lastY:null,timeout:null});r(this,"game",null);this.game=t,this.setEvents()}clickHandler(t,s=!1){const i=t.target,a=i.closest(".cell"),e=i.closest(".btn-restart"),l=i.closest(".btn-size"),c=i.closest(".start-btn"),u=i.closest(".game-over"),d=i.closest(".win");if(a){if(!s&&("ontouchstart"in window||navigator.maxTouchPoints))return;const{x:g,y:f}=a.dataset;this.game.cellClick(+g,+f)}if(e||u||d){this.game.restart();return}if(l){this.game.changeGridSize(+l.dataset.size);return}if(c){this.game.startGame();return}}rightClickHandler(t){t.preventDefault();const i=t.target.closest(".cell");if(i){const{x:a,y:e}=i.dataset;this.game.toggleFlag(+a,+e)}}touchHandler(t){this.touch.lastX=t.touches[0].clientX,this.touch.lastY=t.touches[0].clientY,!(t.touches.length>1)&&(this.touch.timeout=setTimeout(()=>{clearTimeout(this.touch.timeout),this.touch.timeout=null,this.rightClickHandler(t)},200))}touchEndHandler(t){if(this.touch.timeout){clearTimeout(this.touch.timeout),this.touch.timeout=null,this.clickHandler(t,!0);return}this.touch.timeout=null}touchMoveHandler(t){const s=Math.abs(this.touch.lastX-t.touches[0].clientX),i=Math.abs(this.touch.lastY-t.touches[0].clientY);(s+i>3||t.touches.length>1)&&(clearTimeout(this.touch.timeout),this.touch.timeout=null)}setEvents(){document.addEventListener("click",this.clickHandler.bind(this)),"ontouchstart"in window||navigator.maxTouchPoints?(document.addEventListener("touchstart",this.touchHandler.bind(this)),document.addEventListener("touchend",this.touchEndHandler.bind(this)),document.addEventListener("touchmove",this.touchMoveHandler.bind(this))):this.game.htmlElem.addEventListener("contextmenu",this.rightClickHandler.bind(this))}}class S{constructor(t=".game",s=".start-btn",i=15){r(this,"htmlElem");r(this,"startBtn");r(this,"gridSize");r(this,"gameArray");r(this,"controls");r(this,"bobmPercentage",.2);r(this,"firstClick",!0);r(this,"isGameOver",!1);r(this,"lastChange",{x:null,y:null});r(this,"layout",{});this.htmlElem=document.querySelector(t),this.startBtn=document.querySelector(s),this.gridSize=i,this.htmlElem.style.setProperty("--cels",i)}init(){this.createArray(),this.controls=new p(this),this.makeLayout()}makeLayout(){this.layout.btnStart=new m({text:"start",className:"start-btn"}),this.layout.btnGameOver=new m({text:"game over",className:"game-over",isHidden:!0}),this.layout.btnWin=new m({text:"solved!",className:"win",isHidden:!0})}restart(){this.layout.btnGameOver.hide(),this.layout.btnWin.hide(),this.htmlElem.style.setProperty("--cels",this.gridSize),this.firstClick=!0,this.isGameOver=!1,this.createArray(),this.renderArray()}getCell(t,s){return t<0||t>this.gridSize-1||s<0||s>this.gridSize-1?{state:null}:this.gameArray[t][s]}countBombsAround(t,s){let i=0;return this.getCell(t-1,s-1).state===h&&i++,this.getCell(t,s-1).state===h&&i++,this.getCell(t+1,s-1).state===h&&i++,this.getCell(t+1,s).state===h&&i++,this.getCell(t+1,s+1).state===h&&i++,this.getCell(t,s+1).state===h&&i++,this.getCell(t-1,s+1).state===h&&i++,this.getCell(t-1,s).state===h&&i++,i}renderArray(){let t="",s=!0;this.gameArray.forEach((i,a)=>{i.forEach((e,l)=>{(e.state===h&&!e.isFlag||e.state===o&&e.isFlag)&&(s=!1);let c=o;e.state===o?e.showed===!0?c="num cell-num-"+this.countBombsAround(a,l):c=o:e.state===h&&this.isGameOver&&(c=h),e.isFlag&&e.showed===!1&&(c=w,e.state===h&&this.isGameOver&&(c=h));const u=e.showed?"cell-SHOWED":"",d=this.lastChange.x===a&&this.lastChange.y===l?"animate":"";t+=`<div class="cell ${u} cell-${c} ${d}" data-x="${a}" data-y="${l}"></div>`})}),this.htmlElem.innerHTML=t,s&&(this.isGameOver=!0,this.layout.btnWin.show())}createArray(){const t=[];for(let s=0;s<this.gridSize;s++){const i=[];for(let a=0;a<this.gridSize;a++)i.push(new v(this.bobmPercentage));t.push(i)}this.gameArray=t}emptyClick(t,s,i){if(t.showed=!0,this.countBombsAround(s,i)===0){const a=(e,l)=>{e<0||e>this.gridSize-1||l<0||l>this.gridSize-1||(this.countBombsAround(e+1,l)===0&&(this.getCell(e+1,l).showed||(this.getCell(e+1,l).showed=!0,a(e+1,l))),this.countBombsAround(e-1,l)===0&&(this.getCell(e-1,l).showed||(this.getCell(e-1,l).showed=!0,a(e-1,l))),this.countBombsAround(e,l+1)===0&&(this.getCell(e,l+1).showed||(this.getCell(e,l+1).showed=!0,a(e,l+1))),this.countBombsAround(e,l-1)===0&&(this.getCell(e,l-1).showed||(this.getCell(e,l-1).showed=!0,a(e,l-1))),this.getCell(e+1,l).showed=!0,this.getCell(e-1,l).showed=!0,this.getCell(e,l+1).showed=!0,this.getCell(e,l-1).showed=!0,this.getCell(e+1,l).isFlag=!1,this.getCell(e-1,l).isFlag=!1,this.getCell(e,l+1).isFlag=!1,this.getCell(e,l-1).isFlag=!1)};a(s,i)}}cellClick(t,s){if(this.isGameOver)return;this.lastChange.x=+t,this.lastChange.y=+s;const i=this.getCell(t,s);this.firstClick&&(this.firstClick=!1,i.state=o,this.getCell(t-1,s-1).state=o,this.getCell(t+1,s-1).state=o,this.getCell(t+1,s+1).state=o,this.getCell(t-1,s+1).state=o,this.getCell(t,s-1).state=o,this.getCell(t+1,s).state=o,this.getCell(t,s+1).state=o,this.getCell(t-1,s).state=o),i.state===o&&this.emptyClick(i,t,s),i.state===h&&(this.isGameOver=!0,this.layout.btnGameOver.show()),this.renderArray()}toggleFlag(t,s){if(this.isGameOver)return;this.lastChange.x=+t,this.lastChange.y=+s;const i=this.getCell(t,s);i.isShowed||(i.isFlag=!i.isFlag,this.renderArray())}changeGridSize(t){this.gridSize=t,this.restart()}startGame(){this.renderArray(),this.htmlElem.style.opacity=1,this.layout.btnStart.hide()}}new S().init();
